//â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
// **************************************************************
//                  http://www.icocos.cn                       //
//                 https://icocos.github.io                    //
//                https://al1020119.github.io                  //
// **************************************************************
//  ************  ðŸ˜‚ðŸ¤” æ›¹ç†é¹(æ¢¦å·¥åŽ‚@iCocos) ðŸ¤”ðŸ˜‚  ************  //
// **************************************************************
//â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
// **************************************************************
//
//  Single_App
//  DispatchQueue+AppTools
//
//  Created by iCocos on 2018/12/29.
//  Copyright Â© 2018å¹´ iCocos. All rights reserved.
//
// @class DispatchQueue+AppTools.swift
// @abstract è°ƒåº¦å·¥å…·
// @discussion è°ƒåº¦å·¥å…·æ“ä½œ
//
//â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
// **************************************************************

import Foundation

extension AppTools where Base: DispatchQueue {
    /// ä»£ç å»¶è¿Ÿæ‰§è¡Œ
    ///
    /// - Parameters:
    ///   - delay: å»¶è¿Ÿæ—¶é—´ (å•ä½: ç§’)
    ///   - closure: å»¶è¿Ÿæ‰§è¡Œçš„ä»£ç å—
    public func after(_ delay: TimeInterval, execute closure: @escaping () -> Void) {
        base.asyncAfter(deadline: .now() + delay, execute: closure)
    }

    /// åªæ‰§è¡Œä¸€æ¬¡ä¸Žå”¯ä¸€ Token ç›¸å…³çš„ä»£ç å—ã€‚ä»£ç æ˜¯çº¿ç¨‹å®‰å…¨çš„, å³ä½¿åœ¨å­˜åœ¨å¤šçº¿ç¨‹è°ƒç”¨çš„æƒ…å†µä¸‹, ä¹Ÿåªä¼šæ‰§è¡Œä¸€æ¬¡ä»£ç ã€‚
    ///
    /// - Parameters:
    ///   - token: å”¯ä¸€ token çš„åç§°, é‡‡ç”¨åå‘ DNS é£Žæ ¼, å¦‚: com.apple
    ///   - task: åªæ‰§è¡Œä¸€æ¬¡çš„ä»£ç å—
    public static func once(token: String, task: () -> Void) {
        objc_sync_enter(Base.self)

        defer {
            objc_sync_exit(Base.self)
        }

        if Base.onceToken.contains(token) {
            return
        }
        Base.onceToken.append(token)

        task()
    }
}

public extension DispatchQueue {
    fileprivate static var onceToken: [String] = []
}
